<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜åº“ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f7fa; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 10px; margin-bottom: 2rem; }
        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .subtitle { opacity: 0.9; font-size: 1.1rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 2rem; }
        .card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card h2 { color: #667eea; margin-bottom: 1rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 0.5rem; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555; }
        input, textarea, select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 1rem; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-size: 1rem; cursor: pointer; transition: background 0.3s; }
        .btn:hover { background: #5a67d8; }
        .btn-secondary { background: #48bb78; }
        .btn-secondary:hover { background: #38a169; }
        .question-list { max-height: 400px; overflow-y: auto; }
        .question-item { background: #f8f9fa; border-left: 4px solid #667eea; padding: 1rem; margin-bottom: 0.5rem; border-radius: 5px; }
        .question-meta { font-size: 0.9rem; color: #666; margin-top: 0.5rem; }
        .tag { display: inline-block; background: #e9d8fd; color: #553c9a; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px; }
        .difficulty { font-weight: bold; }
        .difficulty.easy { color: #38a169; }
        .difficulty.medium { color: #d69e2e; }
        .difficulty.hard { color: #e53e3e; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .status.success { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #742a2a; }
        .loading { text-align: center; padding: 20px; color: #666; }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            header { padding: 1.5rem; }
            h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š é¢˜åº“ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="subtitle">ç®€å•ã€é«˜æ•ˆçš„é¢˜ç›®ç®¡ç†å¹³å°</p>
        </header>

        <div class="grid">
            <!-- æ·»åŠ é¢˜ç›® -->
            <div class="card">
                <h2>â• æ·»åŠ æ–°é¢˜ç›®</h2>
                <form id="addQuestionForm">
                    <div class="form-group">
                        <label for="content">é¢˜ç›®å†…å®¹</label>
                        <textarea id="content" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="category">åˆ†ç±»</label>
                        <select id="category">
                            <option value="æœªåˆ†ç±»">æœªåˆ†ç±»</option>
                            <option value="ç¼–ç¨‹">ç¼–ç¨‹</option>
                            <option value="æ•°å­¦">æ•°å­¦</option>
                            <option value="è‹±è¯­">è‹±è¯­</option>
                            <option value="ç§‘å­¦">ç§‘å­¦</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="difficulty">éš¾åº¦</label>
                        <select id="difficulty">
                            <option value="easy">ç®€å•</option>
                            <option value="medium" selected>ä¸­ç­‰</option>
                            <option value="hard">å›°éš¾</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" id="tags" placeholder="python,å‡½æ•°,åŸºç¡€">
                    </div>
                    <button type="submit" class="btn">æ·»åŠ é¢˜ç›®</button>
                </form>
                <div id="addStatus" class="status"></div>
            </div>

            <!-- æœç´¢é¢˜ç›® -->
            <div class="card">
                <h2>ğŸ” æœç´¢é¢˜ç›®</h2>
                <div class="form-group">
                    <input type="text" id="searchQuery" placeholder="è¾“å…¥å…³é”®è¯æœç´¢...">
                </div>
                <button onclick="searchQuestions()" class="btn btn-secondary">æœç´¢</button>
                <div id="searchResults" class="question-list">
                    <div class="loading">è¾“å…¥å…³é”®è¯æœç´¢é¢˜ç›®...</div>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®åˆ—è¡¨ -->
        <div class="card">
            <h2>ğŸ“‹ æ‰€æœ‰é¢˜ç›®</h2>
            <button onclick="loadAllQuestions()" class="btn">åˆ·æ–°åˆ—è¡¨</button>
            <div id="allQuestions" class="question-list">
                <div class="loading">æ­£åœ¨åŠ è½½é¢˜ç›®...</div>
            </div>
        </div>

        <!-- ç³»ç»Ÿä¿¡æ¯ -->
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="systemInfo">
                <p>æœåŠ¡å™¨: <span id="serverStatus">æ£€æŸ¥ä¸­...</span></p>
                <p>é¢˜ç›®æ€»æ•°: <span id="totalQuestions">--</span></p>
                <p>APIçŠ¶æ€: <span id="apiStatus">æ£€æŸ¥ä¸­...</span></p>
            </div>
            <button onclick="checkSystem()" class="btn">æ£€æŸ¥ç³»ç»Ÿ</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${isSuccess ? 'success' : 'error'}`;
            setTimeout(() => element.textContent = '', 3000);
        }

        // æ·»åŠ é¢˜ç›®
        document.getElementById('addQuestionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const content = document.getElementById('content').value;
            const category = document.getElementById('category').value;
            const difficulty = document.getElementById('difficulty').value;
            const tags = document.getElementById('tags').value;
            
            try {
                const formData = new FormData();
                formData.append('content', content);
                formData.append('category', category);
                formData.append('tags', tags);
                
                const response = await fetch(`${API_BASE}/questions/text/`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showStatus('addStatus', 'âœ… é¢˜ç›®æ·»åŠ æˆåŠŸï¼', true);
                    document.getElementById('addQuestionForm').reset();
                    loadAllQuestions(); // åˆ·æ–°åˆ—è¡¨
                } else {
                    showStatus('addStatus', 'âŒ æ·»åŠ å¤±è´¥: ' + result.message, false);
                }
            } catch (error) {
                showStatus('addStatus', 'âŒ ç½‘ç»œé”™è¯¯: ' + error.message, false);
            }
        });

        // æœç´¢é¢˜ç›®
        async function searchQuestions() {
            const query = document.getElementById('searchQuery').value;
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query.trim()) {
                resultsDiv.innerHTML = '<div class="loading">è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/questions/?query=${encodeURIComponent(query)}&limit=10`);
                const data = await response.json();
                
                if (data.questions && data.questions.length > 0) {
                    resultsDiv.innerHTML = data.questions.map(q => `
                        <div class="question-item">
                            <div>${q.content}</div>
                            <div class="question-meta">
                                <span class="difficulty ${q.difficulty}">${q.difficulty}</span>
                                <span> | åˆ†ç±»: ${q.category}</span>
                                ${q.tags && q.tags.length > 0 ? ' | æ ‡ç­¾: ' + q.tags.map(t => `<span class="tag">${t}</span>`).join('') : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    resultsDiv.innerHTML = '<div class="loading">æœªæ‰¾åˆ°ç›¸å…³é¢˜ç›®</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="loading">æœç´¢å¤±è´¥: ${error.message}</div>`;
            }
        }

        // åŠ è½½æ‰€æœ‰é¢˜ç›®
        async function loadAllQuestions() {
            const questionsDiv = document.getElementById('allQuestions');
            questionsDiv.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/questions/?limit=50`);
                const data = await response.json();
                
                if (data.questions && data.questions.length > 0) {
                    questionsDiv.innerHTML = data.questions.map(q => `
                        <div class="question-item">
                            <div>${q.content}</div>
                            <div class="question-meta">
                                <span class="difficulty ${q.difficulty}">${q.difficulty}</span>
                                <span> | åˆ†ç±»: ${q.category}</span>
                                ${q.tags && q.tags.length > 0 ? ' | æ ‡ç­¾: ' + q.tags.map(t => `<span class="tag">${t}</span>`).join('') : ''}
                                ${q.has_answer ? ' | <span style="color:green">âœ… æœ‰ç­”æ¡ˆ</span>' : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    questionsDiv.innerHTML = '<div class="loading">æš‚æ— é¢˜ç›®ï¼Œè¯·æ·»åŠ ç¬¬ä¸€ä¸ªé¢˜ç›®</div>';
                }
            } catch (error) {
                questionsDiv.innerHTML = `<div class="loading">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        async function checkSystem() {
            document.getElementById('serverStatus').textContent = 'æ£€æŸ¥ä¸­...';
            document.getElementById('totalQuestions').textContent = '--';
            document.getElementById('apiStatus').textContent = 'æ£€æŸ¥ä¸­...';
            
            try {
                // æ£€æŸ¥æœåŠ¡å™¨
                const healthResponse = await fetch(`${API_BASE}/`);
                document.getElementById('serverStatus').textContent = healthResponse.ok ? 'âœ… è¿è¡Œæ­£å¸¸' : 'âŒ å¼‚å¸¸';
                
                // è·å–é¢˜ç›®æ•°é‡
                const questionsResponse = await fetch(`${API_BASE}/questions/?limit=1`);
                if (questionsResponse.ok) {
                    const data = await questionsResponse.json();
                    document.getElementById('totalQuestions').textContent = data.total || 'æœªçŸ¥';
                }
                
                // æ£€æŸ¥APIæ–‡æ¡£
                const docsResponse = await fetch(`${API_BASE}/docs`);
                document.getElementById('apiStatus').textContent = docsResponse.ok ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
                
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'âŒ è¿æ¥å¤±è´¥';
                document.getElementById('apiStatus').textContent = 'âŒ æ£€æŸ¥å¤±è´¥';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadAllQuestions();
            checkSystem();
            
            // ç›‘å¬æœç´¢æ¡†å›è½¦
            document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchQuestions();
                }
            });
        };
    </script>
</body>
</html>