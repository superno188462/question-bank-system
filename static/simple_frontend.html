<!DOCTYPE html>
<html>
<head>
    <title>é¢˜åº“ç³»ç»Ÿ - ç®€å•å‰ç«¯</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; padding: 20px; }
        .section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }
        input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        .question { background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #4CAF50; }
        .meta { font-size: 0.9em; color: #666; margin-top: 5px; }
        .success { background: #d4edda; color: #155724; padding: 10px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ“š é¢˜åº“ç³»ç»Ÿ - ç®€å•å‰ç«¯</h1>
    
    <div class="section">
        <h2>æ·»åŠ é¢˜ç›®</h2>
        <textarea id="content" placeholder="é¢˜ç›®å†…å®¹..." rows="3"></textarea><br>
        <input id="category" placeholder="åˆ†ç±»" value="æœªåˆ†ç±»"><br>
        <select id="difficulty">
            <option value="easy">ç®€å•</option>
            <option value="medium" selected>ä¸­ç­‰</option>
            <option value="hard">å›°éš¾</option>
        </select><br>
        <input id="tags" placeholder="æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰"><br>
        <button onclick="addQuestion()">æ·»åŠ é¢˜ç›®</button>
        <div id="addResult"></div>
    </div>
    
    <div class="section">
        <h2>æœç´¢é¢˜ç›®</h2>
        <input id="search" placeholder="æœç´¢å…³é”®è¯" onkeypress="if(event.key=='Enter')searchQuestions()">
        <button onclick="searchQuestions()">æœç´¢</button>
        <div id="searchResults"></div>
    </div>
    
    <div class="section">
        <h2>æ‰€æœ‰é¢˜ç›®</h2>
        <button onclick="loadQuestions()">åˆ·æ–°</button>
        <div id="questions"></div>
    </div>
    
    <script>
        const API = 'http://localhost:8000';
        
        function showMsg(element, msg, isError = false) {
            element.innerHTML = `<div class="${isError ? 'error' : 'success'}">${msg}</div>`;
            setTimeout(() => element.innerHTML = '', 3000);
        }
        
        async function addQuestion() {
            const content = document.getElementById('content').value;
            if (!content) return alert('è¯·è¾“å…¥é¢˜ç›®å†…å®¹');
            
            const form = new FormData();
            form.append('content', content);
            form.append('category', document.getElementById('category').value);
            form.append('tags', document.getElementById('tags').value);
            
            try {
                const res = await fetch(API + '/questions/text/', { method: 'POST', body: form });
                const data = await res.json();
                showMsg(document.getElementById('addResult'), 
                    data.status === 'success' ? 'âœ… æ·»åŠ æˆåŠŸï¼' : 'âŒ æ·»åŠ å¤±è´¥');
                if (data.status === 'success') {
                    document.getElementById('content').value = '';
                    loadQuestions();
                }
            } catch (e) {
                showMsg(document.getElementById('addResult'), 'âŒ ç½‘ç»œé”™è¯¯: ' + e.message, true);
            }
        }
        
        async function searchQuestions() {
            const query = document.getElementById('search').value;
            if (!query) return;
            
            const results = document.getElementById('searchResults');
            results.innerHTML = 'æœç´¢ä¸­...';
            
            try {
                const res = await fetch(API + '/questions/?query=' + encodeURIComponent(query));
                const data = await res.json();
                
                if (data.questions && data.questions.length) {
                    results.innerHTML = data.questions.map(q => `
                        <div class="question">
                            <div>${q.content}</div>
                            <div class="meta">${q.category} | ${q.difficulty}</div>
                        </div>
                    `).join('');
                } else {
                    results.innerHTML = 'æœªæ‰¾åˆ°ç›¸å…³é¢˜ç›®';
                }
            } catch (e) {
                results.innerHTML = 'æœç´¢å¤±è´¥: ' + e.message;
            }
        }
        
        async function loadQuestions() {
            const container = document.getElementById('questions');
            container.innerHTML = 'åŠ è½½ä¸­...';
            
            try {
                const res = await fetch(API + '/questions/?limit=20');
                const data = await res.json();
                
                if (data.questions && data.questions.length) {
                    container.innerHTML = data.questions.map(q => `
                        <div class="question">
                            <div>${q.content}</div>
                            <div class="meta">
                                ${q.category} | ${q.difficulty} 
                                ${q.tags && q.tags.length ? '| æ ‡ç­¾: ' + q.tags.join(', ') : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = 'æš‚æ— é¢˜ç›®';
                }
            } catch (e) {
                container.innerHTML = 'åŠ è½½å¤±è´¥: ' + e.message;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é¢˜ç›®
        window.onload = loadQuestions;
    </script>
</body>
</html>